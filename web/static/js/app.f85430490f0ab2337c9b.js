webpackJsonp([1],{"+skl":function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("7+uW"),r=a("mtWM"),s=a.n(r),i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var p=a("VU/8")({created:function(){}},i,!1,function(t){a("Xztr")},null,null).exports,o=a("/ocq"),l=a("Xxa5"),u=a.n(l),c=a("exGp"),d=a.n(c),m=a("Y4FN"),h=a.n(m),f={name:"HelloWorld",data:function(){return{username:"",password:"",gitlabAppIndex:null,marathonAppIndex:null,gitlabApps:[],marathonApps:[],currentStep:0,logining:!1,latestUUID:""}},computed:{hasLogin:function(){return this.gitlabApps.length>0||this.marathonApps.length>0},selectedGitlabApp:function(){return null===this.gitlabAppIndex?null:this.gitlabApps[this.gitlabAppIndex]},selectedMarathonApp:function(){return null===this.marathonAppIndex?null:this.marathonApps[this.marathonAppIndex]},logHref:function(){return location.href.split("#/")[0]+"#/deploy-log/"+this.latestUUID}},methods:{login:function(){var t=this;return d()(u.a.mark(function e(){var a,n,r,i,p;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h.a.set("userInfo",{username:t.username,password:t.password}),t.logining=!0,e.next=4,s.a.post("/v1/api/login",{username:t.username,password:t.password});case 4:if(a=e.sent,n=a.data,t.logining=!1,r=n.code,i=n.data,p=n.message,"0"===r){e.next=11;break}return t.$Message.error({content:p}),e.abrupt("return");case 11:h.a.set("appData",i),t.gitlabApps=i.gitlabApps||t.gitlabApps,t.marathonApps=i.marathonApps||t.marathonApps,t.currentStep=1;case 15:case"end":return e.stop()}},e,t)}))()},deploy:function(){var t=this;return d()(u.a.mark(function e(){var a,n,r,i,p;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.post("/v1/api/autodeploy",{username:t.username,password:t.password,maintainer:t.selectedGitlabApp.Maintainer,name:t.selectedGitlabApp.Name,marathon_id:t.selectedMarathonApp,marathon_name:t.selectedMarathonApp.toLowerCase().replace(/[^0-9a-z-]/g,"-")});case 2:if(a=e.sent,n=a.data,r=n.code,i=n.data,p=n.message,"0"===r){e.next=8;break}return t.$Message.error({content:p}),e.abrupt("return");case 8:t.latestUUID=i.uuid,t.$nextTick(function(e){window.open(t.logHref)});case 10:case"end":return e.stop()}},e,t)}))()},prevStep:function(){this.currentStep-=1},nextStep:function(){this.currentStep+=1}},created:function(){var t=h.a.get("userInfo",{}),e=h.a.get("appData",null);this.username=t.username,this.password=t.password,e?(this.gitlabApps=e.gitlabApps,this.marathonApps=e.marathonApps,this.currentStep=1):this.username&&this.password?this.login():this.currentStep=0},mounted:function(){}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hello"},[a("div",{staticStyle:{"margin-bottom":"16px","text-align":"center"}},[a("Steps",{attrs:{current:t.currentStep}},[a("Step",{attrs:{title:"登录",content:"登录 gitlab"}}),t._v(" "),a("Step",{attrs:{title:"部署",content:"选择项目部署"}})],1)],1),t._v(" "),a("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.currentStep,expression:"currentStep === 0"}],staticStyle:{width:"400px"}},[a("Input",{attrs:{placeholder:"username"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),a("Input",{attrs:{placeholder:"password",type:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t._v(" "),a("div",{staticStyle:{"margin-top":"8px"}},[a("Button",{attrs:{type:"default",disabled:!t.hasLogin},on:{click:t.nextStep}},[t._v("下一步")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")])],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.currentStep,expression:"currentStep === 1"}],staticStyle:{width:"400px"}},[a("Select",{attrs:{placeholder:"选择 gitlab 项目",filterable:""},model:{value:t.gitlabAppIndex,callback:function(e){t.gitlabAppIndex=e},expression:"gitlabAppIndex"}},t._l(t.gitlabApps,function(e,n){return a("Option",{key:e.Maintainer+"/"+e.Name,attrs:{value:n}},[t._v("\n            "+t._s(e.Maintainer+"/"+e.Name)+"\n          ")])})),t._v(" "),a("Select",{attrs:{placeholder:"选择 marathon 项目",filterable:""},model:{value:t.marathonAppIndex,callback:function(e){t.marathonAppIndex=e},expression:"marathonAppIndex"}},t._l(t.marathonApps,function(e,n){return a("Option",{key:e,attrs:{value:n}},[t._v("\n            "+t._s(e)+"\n          ")])})),t._v(" "),a("div",{staticStyle:{"margin-top":"8px"}},[a("Button",{attrs:{type:"default"},on:{click:t.prevStep}},[t._v("上一步")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.deploy}},[t._v("部署")])],1)],1)]),t._v(" "),t.logining?a("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},staticRenderFns:[]};var g=a("VU/8")(f,v,!1,function(t){a("y108")},"data-v-ce5e3e8c",null).exports,x=a("BYKG").fromJS,S={data:function(){return{data:x({})}},computed:{uuid:function(){return this.$route.params.uuid},step:function(){return this.data.getIn(["data","step"],0)},title:function(){return this.data.getIn(["data","params","maintainer"],"")+"/"+this.data.getIn(["data","params","name"],"")+" -> "+this.data.getIn(["data","params","marathon_name"],"")},tag:function(){return this.data.getIn(["data","tag"],"")},image:function(){return this.data.getIn(["data","image"],"")},status:function(){var t=this.data.getIn(["data","status"],0);switch(t){case 0:return"NOT START";case 1:return"RUNNING";case 2:return"SUCCEED";case-1:return"FAILED";default:return"I DONT KNOW"}}},created:function(){var t=this,e="ws://"+location.host+"/deploy/"+this.uuid,a=new WebSocket(e);a.onopen=function(e){a.send(t.uuid)},a.onmessage=function(e){t.data=x(JSON.parse(e.data))}}},A={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"16px",display:"flex","flex-direction":"column","align-items":"center"}},[a("div",{staticClass:"title",staticStyle:{"font-size":"16px","margin-bottom":"16px","font-weight":"bold"}},[t._v(t._s(t.title))]),t._v(" "),a("div",{staticStyle:{display:"flex"}},[a("Steps",{attrs:{current:t.step,direction:"vertical"}},[a("Step",{attrs:{title:"TAGING",content:t.tag}}),t._v(" "),a("Step",{attrs:{title:"BUILDING",content:t.image}}),t._v(" "),a("Step",{attrs:{title:"DEPLOYING",content:"DEPLOYING"}}),t._v(" "),a("Step",{attrs:{title:"FINISH",content:"FINISH"}})],1),t._v(" "),a("div",{staticClass:"status",staticStyle:{width:"250px"}},[t._v("\n      STATUS："+t._s(t.status)+"\n    ")])],1)])},staticRenderFns:[]},_=a("VU/8")(S,A,!1,null,null,null).exports;n.default.use(o.a);var w=new o.a({routes:[{path:"/",name:"HelloWorld",component:g},{path:"/deploy-log/:uuid",name:"DeployLog",component:_}]}),I=a("BTaQ"),b=a.n(I);a("+skl");n.default.config.productionTip=!1,n.default.use(b.a),new n.default({el:"#app",router:w,components:{App:p},template:"<App/>"})},Xztr:function(t,e){},y108:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.f85430490f0ab2337c9b.js.map