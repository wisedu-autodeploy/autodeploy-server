webpackJsonp([1],{"+skl":function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),r=n("mtWM"),i=n.n(r),s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var o=n("VU/8")({created:function(){}},s,!1,function(t){n("Xztr")},null,null).exports,l=n("/ocq"),p=n("Xxa5"),u=n.n(p),c=n("exGp"),d=n.n(c),h=n("Y4FN"),m=n.n(h),g={name:"HelloWorld",data:function(){var t=this;return{username:"",password:"",gitlabAppIndex:null,marathonAppIndex:null,gitlabApps:[],marathonApps:[],currentStep:0,logining:!1,latestUUID:"",historyData:[],historyColumns:[{title:"项目名称",key:"name",render:function(t,e){return t("div",[t("span",{style:{color:"blue"}},[e.row.maintainer]),t("span",["/"]),t("span",{style:{fontWeight:"bold",color:"red"}},[e.row.name])])}},{title:"marathon_id",key:"marathon_id"},{title:"option",key:"option",width:150,render:function(e,n){return e("div",{style:{display:"flex",justifyContent:"space-around"}},[e("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.deploy(n.row)}}},"再次部署"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.remove(n.row)}}},"删除")])}}]}},computed:{hasLogin:function(){return this.gitlabApps.length>0||this.marathonApps.length>0},selectedGitlabApp:function(){return null===this.gitlabAppIndex?null:this.gitlabApps[this.gitlabAppIndex]},selectedMarathonApp:function(){return null===this.marathonAppIndex?null:this.marathonApps[this.marathonAppIndex]},logHref:function(){return location.href.split("#/")[0]+"#/deploy-log/"+this.latestUUID},disableDeploy:function(){return!this.selectedGitlabApp||!this.selectedMarathonApp}},methods:{login:function(){var t=this;return d()(u.a.mark(function e(){var n,a,r,s,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.a.set("userInfo",{username:t.username,password:t.password}),t.logining=!0,e.next=4,i.a.post("/v1/api/login",{username:t.username,password:t.password});case 4:if(n=e.sent,a=n.data,t.logining=!1,r=a.code,s=a.data,o=a.message,"0"===r){e.next=11;break}return t.$Message.error({content:o}),e.abrupt("return");case 11:m.a.set("appData",s),t.gitlabApps=s.gitlabApps||t.gitlabApps,t.marathonApps=s.marathonApps||t.marathonApps,t.currentStep=1;case 15:case"end":return e.stop()}},e,t)}))()},deploy:function(t){var e=this;return d()(u.a.mark(function n(){var a,r,s,o,l;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=t||{username:e.username,password:e.password,maintainer:e.selectedGitlabApp.Maintainer,name:e.selectedGitlabApp.Name,marathon_id:e.selectedMarathonApp,marathon_name:e.selectedMarathonApp.toLowerCase().replace(/[^0-9a-z-]/g,"-")},n.next=3,i.a.post("/v1/api/autodeploy",t);case 3:if(a=n.sent,r=a.data,s=r.code,o=r.data,l=r.message,"0"===s){n.next=9;break}return e.$Message.error({content:l}),n.abrupt("return");case 9:e.updateHistory(t),e.latestUUID=o.uuid,e.$nextTick(function(t){window.open(e.logHref)});case 12:case"end":return n.stop()}},n,e)}))()},remove:function(t){var e=m.a.get("history",[]),n=e.findIndex(function(e){return e.maintainer===t.maintainer&&e.name==t.name&&e.marathon_id==t.marathon_id});-1!==n&&e.splice(n,1),m.a.set("history",e),this.historyData=e},updateHistory:function(t){var e=m.a.get("history",[]),n=e.findIndex(function(e){return e.maintainer===t.maintainer&&e.name==t.name&&e.marathon_id==t.marathon_id});-1!==n?(e.splice(n,1),e.unshift(t)):e.unshift(t),e.length=e.length>5?5:e.length,m.a.set("history",e),this.historyData=e},prevStep:function(){this.currentStep-=1},nextStep:function(){this.currentStep+=1}},created:function(){var t=m.a.get("userInfo",{}),e=m.a.get("appData",null);this.historyData=m.a.get("history",[]),this.username=t.username,this.password=t.password,e?(this.gitlabApps=e.gitlabApps,this.marathonApps=e.marathonApps,this.currentStep=1):this.username&&this.password?this.login():this.currentStep=0},mounted:function(){}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"hello"},[n("div",{staticStyle:{"margin-bottom":"16px","text-align":"center"}},[n("Steps",{attrs:{current:t.currentStep}},[n("Step",{attrs:{title:"登录",content:"登录 gitlab"}}),t._v(" "),n("Step",{attrs:{title:"部署",content:"选择项目部署"}})],1)],1),t._v(" "),n("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:0===t.currentStep,expression:"currentStep === 0"}],staticStyle:{width:"400px"}},[n("Input",{attrs:{placeholder:"username"},on:{"on-enter":t.login},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),n("Input",{attrs:{placeholder:"password",type:"password"},on:{"on-enter":t.login},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t._v(" "),n("div",{staticStyle:{"margin-top":"8px"}},[n("Button",{attrs:{type:"default",disabled:!t.hasLogin},on:{click:t.nextStep}},[t._v("下一步")]),t._v(" "),n("Button",{attrs:{type:"primary"},on:{click:t.login}},[t._v(t._s(t.hasLogin?"更新数据":"登录"))])],1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:1===t.currentStep,expression:"currentStep === 1"}],staticStyle:{width:"600px",display:"flex","flex-direction":"column","align-items":"center"}},[n("div",{staticStyle:{width:"400px"}},[n("Select",{attrs:{placeholder:"选择 gitlab 项目",filterable:""},model:{value:t.gitlabAppIndex,callback:function(e){t.gitlabAppIndex=e},expression:"gitlabAppIndex"}},t._l(t.gitlabApps,function(e,a){return n("Option",{key:e.Maintainer+"/"+e.Name,attrs:{value:a}},[t._v("\n              "+t._s(e.Maintainer+"/"+e.Name)+"\n            ")])})),t._v(" "),n("Select",{attrs:{placeholder:"选择 marathon 项目",filterable:""},model:{value:t.marathonAppIndex,callback:function(e){t.marathonAppIndex=e},expression:"marathonAppIndex"}},t._l(t.marathonApps,function(e,a){return n("Option",{key:e,attrs:{value:a}},[t._v("\n              "+t._s(e)+"\n            ")])})),t._v(" "),n("div",{staticStyle:{"margin-top":"8px"}},[n("Button",{attrs:{type:"default"},on:{click:t.prevStep}},[t._v("上一步")]),t._v(" "),n("Button",{attrs:{type:"default"},on:{click:t.login}},[t._v("更新数据")]),t._v(" "),n("Button",{attrs:{type:"primary",disabled:t.disableDeploy},on:{click:function(e){t.deploy(null)}}},[t._v("部署")])],1)],1),t._v(" "),n("div",{staticStyle:{"margin-top":"16px"}},[n("h2",[t._v("历史记录")]),t._v(" "),n("Table",{attrs:{border:"",columns:t.historyColumns,data:t.historyData}})],1)])]),t._v(" "),t.logining?n("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},staticRenderFns:[]};var v=n("VU/8")(g,f,!1,function(t){n("cWDt")},"data-v-6b7dd53a",null).exports,y=n("BYKG").fromJS,x={data:function(){return{data:y({}),log:[]}},computed:{uuid:function(){return this.$route.params.uuid},step:function(){return this.data.getIn(["data","step"],0)},title:function(){return this.data.getIn(["data","params","maintainer"],"")+"/"+this.data.getIn(["data","params","name"],"")+" -> "+this.data.getIn(["data","params","marathon_name"],"")},tag:function(){return this.data.getIn(["data","tag"],"")},image:function(){return this.data.getIn(["data","image"],"")},status:function(){var t=this.data.getIn(["data","status"],0);switch(t){case 0:return"NOT START";case 1:return"RUNNING";case 2:return"SUCCEED";case-1:return"FAILED";default:return"I DONT KNOW"}},formatLog:function(){return this.log.join("<br/>")}},created:function(){var t=this,e="ws://"+location.host+"/deploy/"+this.uuid;var n=new WebSocket(e);n.onopen=function(e){n.send(t.uuid)},n.onmessage=function(e){if(t.data=y(JSON.parse(e.data)),"-1"===t.data.get("code"))return t.$Notice.error({title:"部署出错",desc:t.data.get("message"),duration:0});t.log=t.data.getIn(["data","log"],[])}},watch:{log:function(){var t=this.$refs.logContainer;t&&(t.scrollTop=t.scrollHeight-t.clientHeight)}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"16px"}},[n("div",{staticClass:"title",staticStyle:{"font-size":"16px","margin-bottom":"16px","font-weight":"bold"}},[t._v(t._s(t.title))]),t._v(" "),n("div",[n("Steps",{attrs:{current:t.step}},[n("Step",{attrs:{title:"TAGING",content:t.tag}}),t._v(" "),n("Step",{attrs:{title:"BUILDING",content:t.image}}),t._v(" "),n("Step",{attrs:{title:"DEPLOYING",content:"DEPLOYING"}}),t._v(" "),n("Step",{attrs:{title:"FINISH",content:"FINISH"}})],1)],1),t._v(" "),n("div",{staticStyle:{"margin-top":"16px"}},[n("h2",[t._v("BUILD LOG:")]),t._v(" "),n("div",{ref:"logContainer",staticClass:"log",staticStyle:{height:"calc(100vh - 300px)",overflow:"auto","margin-left":"16px"},domProps:{innerHTML:t._s(t.formatLog)}})])])},staticRenderFns:[]},b=n("VU/8")(x,_,!1,null,null,null).exports;a.default.use(l.a);var w=new l.a({routes:[{path:"/",name:"HelloWorld",component:v},{path:"/deploy-log/:uuid",name:"DeployLog",component:b}]}),S=n("BTaQ"),A=n.n(S);n("+skl");a.default.config.productionTip=!1,a.default.use(A.a),new a.default({el:"#app",router:w,components:{App:o},template:"<App/>"})},Xztr:function(t,e){},cWDt:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.6dd648379f64c4efa8a3.js.map